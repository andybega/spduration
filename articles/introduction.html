<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Splitting it Up: The `spduration` Split-population Duration Regression Package • spduration</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Splitting it Up: The `spduration` Split-population Duration Regression Package">
<meta property="og:description" content="spduration">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spduration</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.17.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Splitting it Up: The `spduration` Split-population Duration Regression Package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andybega/spduration/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Splitting it Up: The <code>spduration</code> Split-population Duration Regression Package</h1>
                        <h4 class="author">Andreas Beger, Daniel W. Hill, Jr., Nils W. Metternich, Shahryar Minhas, and Michael D. Ward</h4>
            
            <h4 class="date">2020-07-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andybega/spduration/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>We present an implementation of split-population duration regression in the <code>spduration</code> R package and an application to data on military coups. The statistical model accounts for units that are immune to a certain outcome and not part of the duration process the researcher is primarily interested in. We provide insights that if immune units exist, we can significantly increase the predictive performance compared to standard duration models. The package includes estimation and several post-estimation methods for split-population Weibull and Loglogistic models.</p>
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Duration models are an important class of statistical estimators that take into account the duration dependency of specific outcomes. A prominent example is that the risk of dying depends on the age of an individual. Newborns are at a greater risk of dying, but as they grow older this risk quickly declines and then gradually starts to increase again after the age of 9-10. While individual behavior (smoking, exercising, diet) and structural factors (health care, health regulations, urban vs rural) can increase or decrease the probability of dying over time, the underlying risk is time dependent and impacts on all individuals.</p>
<p>However, there are conditions under which not all individuals have the same underlying risk to experience a specific outcome and might not even be at risk at all. Consider the risk of acquiring a viral infection like the common flu. Let us initially assume that everyone is at risk of infection, and individual behavior (e.g., good hygiene) and structural factors (e.g., workplace) determine whether individuals catch the flu. Under these assumptions a standard duration model should provide us with efficient estimates of how different behavioral and structural factors impact on the general baseline risk. But, there might be individuals that are immune to the flu in the overall population–because they received vaccination, had the specific flu virus in the past, or have some other characteristic that makes it impossible for them to attract the disease. In this instance we have two underlying populations: an at risk population and an immune one. If the immune population is relatively large, estimates using a standard duration model will be biased and predictions inaccurate.</p>
</div>
<div id="immune-populations-and-inference-of-duration-processes" class="section level1">
<h1 class="hasAnchor">
<a href="#immune-populations-and-inference-of-duration-processes" class="anchor"></a>Immune populations and inference of duration processes</h1>
<p>Regular duration models, where baseline risk is modeled by some distribution of time, were originally developed in health and demographic research and grew naturally from life tables and survival records for medical patients. Basic formulations of such models, like the parametric exponential or Weibull regressions or semi-parametric Cox regression, implicitly assume that all subjects or units under observation, including right-censored observations, will eventually experience the event of interest. This assumption may be violated in many substantive areas and empirical applications, where a sub-population of units or individuals will never experience an event, and thus are effectively ``cured’’.</p>
<p>The insight that populations might be split in regard to their baseline risk has been formulated as early as 1949 by <span class="citation">Boag (1949)</span> and <span class="citation">Berkson and Gage (1952)</span>, who were researching survival rates in cancer patients. In their application some fraction of patients survived because their cancer was cured, while others relapsed after apparent remission due to levels of disease below detectable thresholds. The development of duration methods in health and medicine has also shaped the terminology conventionally used for such models. For example, split-population duration models are also referred to as cure rate models. Similarly, the basic concepts like survival and failure rates reference the survival of humans.</p>
<p>Yet the intuition underlying split-population duration models has led to applications in a broad range of subject areas outside demographics and medicine. In an early and foundational application that reached beyond medicine, <span class="citation">Schmidt and Witte (1989)</span> examined criminal recidivism using data on close to 10,000 prisoners from the North Carolina prison system in the late 1970’s and early 1980’s to identify factors that influence whether a criminal relapses at all, and if so which factors are related to the amount of time between prison stints. This work already includes a full formulation of a model with independent covariates for both the duration equation and the risk or cure equation, although only with subject-specific covariates rather than time-varying covariates for multiple data points per individual.</p>
<p>In a complementary set of research from public health, <span class="citation">Douglas and Hariharan (1994)</span> use data from the United States to model the age at which individuals began to smoke, and <span class="citation">Forster and Jones (2001)</span> examine the impact of tobacco taxes on smoking and quitting decisions. <span class="citation">DeYoung (2003)</span>, an economist, models the failure of new commercial banks in the US during the 1980’s. <span class="citation">Svolik (2008)</span> uses a split-population duration framework to examine whether democratic regimes persist or revert to authoritarianism, and when. Building on this effort, split-population duration models have also been used, along with other models, to produce regular predictions for five different forms of political conflict for the Integrated Crisis and Early Warning System (ICEWS) project <span class="citation">(Ward et al. 2013)</span> and to model irregular leadership changes for the Political Instability Task Force <span class="citation">(PITF; Beger, Dorff, and Ward 2014)</span>.</p>
</div>
<div id="model-development" class="section level1">
<h1 class="hasAnchor">
<a href="#model-development" class="anchor"></a>Model development</h1>
<p>Conventional duration models assume that all subjects will eventually fail, die, or experience a specific outcome. The likelihood for a data point with survival time <span class="math inline">\(t\)</span> is thus the failure rate <span class="math inline">\(f(t)\)</span> at that time or the probability of survival beyond <span class="math inline">\(t\)</span>, <span class="math inline">\(S(t)\)</span>, depending on whether the subject has already experienced the event (<span class="math inline">\(\delta_i\)</span>) or is right-censored (<span class="math inline">\(1-\delta_i\)</span>): <span class="math display">\[\begin{eqnarray}
\mathcal{L} = \prod_{i=1}^N  \left( f(t_i)\right)^{\delta_i} \times \left( S(t_i) \right)^{1-\delta_i}
\end{eqnarray}\]</span></p>
<p>The major modeling question in this setting, which we will return to below, is the choice of a function form (e.g., exponential, Weibull, or log-logistic) describing the underlying hazard rate <span class="math inline">\(h(t) = \frac{f(t)}{S(t)}\)</span> over time.</p>
<p>The cumulative failure rate (<span class="math inline">\(F(t) = 1 - S(t)\)</span>) over time converges to 1, meaning all subjects fail eventually. In the examples of applied research discussed above this assumption is untenable. Some cancer patients are cured after treatment, most young people never become regular smokers, and many states will not experience the kind of violence that persists in other parts of the world. The presence of a large sub-population which is not at risk for an event, will in practice inflate estimates of the survival fraction, and reduce hazard estimates for all subjects. This is the case because the underlying risk is estimated based on subjects that genuinely will fail and those that are cured. Hence, such a model will over predict the hazard for subjects that are not at risk (cured), and under predict for those who are at risk of eventually experiencing the event of interest.</p>
<p>We can incorporate the presence of a sub-population, where we label the subpopulation at risk with <span class="math inline">\(\pi\)</span>, by rewriting the likelihood as:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p><span class="math display">\[\begin{align}
\mathcal{L}\{\theta|(t_{1}, \dots, t_{n})\} &amp;= \prod_{i=1}^{N} \left(\pi_i f(t_i)\right)^{\delta_i} \times  \left((1-\pi_i) + \pi_i S(t_i)\right)^{1-\delta_i}
\end{align}\]</span></p>
<p>Crucially, this split-population framework is primarily useful in contexts where sub-populations are not clearly or easily identifiable. For example, there is a clear sub-population in a model of the age at first pregnancy for humans—men—which researchers can easily identify and exclude from their data. Less clear are answers to questions such as whether a cancer patient is cured or not cured given that they have no visible signs of cancer following treatment or have hit the 5-year disease free survival mark. In such situations split-population models provide a way to infer sub-populations in a probabilistic fashion.</p>
<p>Early efforts focused only on the cure rate (<span class="math inline">\(1 - \pi\)</span>) and treated it as a constant, but we can model membership in the subpopulation with its own covariates through a logistic link function:</p>
<p><span class="math display">\[\begin{align}
\pi_i &amp;= \frac{1}{1 + e^{-z_i \gamma}}
\end{align}\]</span></p>
<p>Where <span class="math inline">\(z_i\)</span> is a vector of covariates for a subject at a given time. For interpretation, it is important to note that with time-varying covariates, the risk (or cured) estimate for a subject is particular to a given time point rather than constant over all time periods in the spell.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Depending on the covariates, the risk estimate for a subject can thus fluctuate over time. To ease interpretation, it might be convenient to restrict covariates in the logit risk model to slow-moving, stable covariates in order to produce stable risk estimates for subjects.</p>
<p>The last component to complete the likelihood is the choice of a distribution for the shape of the hazard rate. The <code>spduration</code> package implements two hazard rate shapes, Weibull and log-logistic:</p>
<p><span class="math display">\[\begin{eqnarray*}
\textrm{Weibull} \\
 f(t) &amp; = &amp; \alpha \lambda (\lambda t)^{\alpha - 1} e^{-(\lambda t)^\alpha} \\
  S(t) &amp; = &amp; e^{ -(\lambda t )^\alpha } \\
 h(t) &amp; = &amp; \alpha \lambda (\lambda t)^{\alpha-1} \\
\textrm{Log-logistic} \\
 f(t) &amp; = &amp; \frac{ \alpha \lambda (\lambda t)^{\alpha-1} }{ (1 + (\lambda t)^\alpha)^2 } \\
 S(t) &amp; = &amp; \frac{1}{ 1+  (\lambda t)^\alpha }  \\
 h(t) &amp; = &amp; \frac{ \alpha \lambda (\lambda t)^{\alpha-1} }{ 1+  (\lambda t)^\alpha }
\end{eqnarray*}\]</span></p>
<p>Where <span class="math inline">\(\lambda = e^{-x_i\beta}\)</span> is a parameter of covariates. The Weibull density allows for hazard rates that are increasing, constant, or decreasing over survival time, while the log-logistic density also can fit rates that have a peak at a particular survival time.</p>
<p>Given the density distribution, the main quantity of interest is the conditional hazard <span class="math inline">\(h(t, \pi)\)</span>, where both the risk/cure probabilities and hazard are conditional on survival to time <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[\begin{eqnarray}
h(t, \pi) = \frac{f(t, \pi)}{S(t, \pi)} &amp; = &amp; \frac{ \pi(t) \times f(t) }{ (1-\pi(t)) + \pi(t) \times S(t) } \\
 \pi(t) &amp; = &amp; \frac{ 1-\pi }{ S(t) + (1-\pi) (1 - S(t)) }
\end{eqnarray}\]</span></p>
<p>For a given unconditional risk rate <span class="math inline">\(\pi\)</span>, the probability that a subject with survival time <span class="math inline">\(t\)</span> is in the risk set decreases over time, because an increasing number of surviving cases consist of immune or cured (<span class="math inline">\(1-\pi\)</span>) cases that will never fail. In the hazard rate, the failure rate in the numerator is conditional on the probability that a case is in the risk set, given survival up to time <span class="math inline">\(t\)</span>, and the numerator is an adjusted survivor function that accounts for the fraction of cured cases by time <span class="math inline">\(t\)</span>, which is <span class="math inline">\(1-\pi(t)\)</span>.</p>
</div>
<div id="fit-a-split-population-model-on-coups-data" class="section level1">
<h1 class="hasAnchor">
<a href="#fit-a-split-population-model-on-coups-data" class="anchor"></a>Fit a split-population model on coups data</h1>
<p>In order to illustrate the package functionality, we examine a model of coups d`etat in <span class="citation">Belkin and Schofer (2003)</span>. Belkin and Schofer’s paper lends itself to re-analysis with a split-population duration model because they explicitly distinguish long-term structural risk factors for coups from more short-term triggering causes that can explain the timing of a coup in an at-risk regime. They argue that many countries never experience coups because coups are effectively impossible due to structural factors, while others that never experience coups are nevertheless at risk due to a different configuration of those same factors. Using language which fits nicely with the class of models described above, they write “[t]riggers are not the source of the original risk, and in the absence of structural causes, the presence of triggering factors alone cannot lead to a coup. Hence, triggers should not be equated with coup risk. Rather, they are factors that may determine the exact timing of a coup in regimes that suffer from high coup risk” <span class="citation">(Belkin and Schofer 2003, 598)</span>.</p>
<p>For their empirical test Belkin and Schofer develop a measure of “structural coup risk” which incorporates factors such as the strength of democratic institutions and civil society, and a recent history of successful coups. However, they implement a logistic regression model, which does not capture the process as described in their quote above. This is because the logistic regression model assumes that all observations are at risk for a coup (i.e., the probability of a coup is non-zero for all observations). Since their structural coup risk indicator is developed precisely to distinguish between at risk and “immune” cases, the split-population model allows one to examine whether the indicator effectively does so.</p>
<p>We begin by loading the package and the Belkin and Schofer replication data, and formatting the data to add several variables needed by the split-population duration model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://github.com/andybega/spduration">"spduration"</a></span>)
</pre></div>
<pre><code>## Registered S3 method overwritten by 'quantmod':
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">bscoup</span>)
<span class="op">?</span><span class="kw">bscoup</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">bscoup</span>[, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>])
</pre></div>
<pre><code>##   countryid year  couprisk recentcoups rwar
## 1       909 1960 0.2200166           0    0
## 2       909 1961 0.2200166           0    0
## 3       909 1962 0.2200166           0    0
## 4       909 1963 0.2200166           0    0
## 5       909 1964 2.5702426           1    0
## 6       909 1965 2.5702426           2    0</code></pre>
<p>The data are documented in <code><a href="../reference/bscoup.html">?bscoup</a></code>, which also gives a reference to the source citation. It consists of a little more than 5,000 observations of 162 countries from 1960 to 2000. Each row corresponds to a country <em>c</em> in year <em>t</em>. Excluding the country and year identifiers, the data include 12 variables, including a binary indicator for successful coups.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">bscoup</span>)
</pre></div>
<pre><code>## 'data.frame':    5463 obs. of  14 variables:
##  $ countryid  : num  909 909 909 909 909 909 909 920 920 920 ...
##  $ year       : num  1960 1961 1962 1963 1964 ...
##  $ couprisk   : num  0.22 0.22 0.22 0.22 2.57 ...
##  $ recentcoups: num  0 0 0 0 1 2 4 0 0 0 ...
##  $ rwar       : num  0 0 0 0 0 0 1 0 0 0 ...
##  $ milreg     : num  0 0 0 1 0 1 1 0 0 0 ...
##  $ wealth     : num  NA NA NA NA NA ...
##  $ instab     : num  4 2 9 9 12 13 12 NA 0 4 ...
##  $ coup       : Factor w/ 2 levels "no","yes": 1 1 1 2 2 2 1 1 1 1 ...
##  $ africa     : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ eurnam     : num  0 0 0 0 0 0 0 1 1 1 ...
##  $ samerica   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ camerica   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ regconf    : num  0 0 0 0.019 0.019 ...
##  - attr(*, "datalabel")= chr ""
##  - attr(*, "time.stamp")= chr "30 Jul 2003 12:15"
##  - attr(*, "formats")= chr [1:14] "%9.0g" "%9.0g" "%9.0g" "%9.0g" ...
##  - attr(*, "types")= int [1:14] 102 102 102 102 102 102 102 102 102 102 ...
##  - attr(*, "val.labels")= chr [1:14] "" "" "" "" ...
##  - attr(*, "var.labels")= chr [1:14] "country code .pr89" "year coded" "" "" ...
##  - attr(*, "version")= int 7
##  - attr(*, "label.table")=List of 1
##   ..$ hadcoup: Named int [1:2] 0 1
##   .. ..- attr(*, "names")= chr [1:2] "no" "yes"</code></pre>
<p>Altogether the data include 290 coups, which makes for a positive rate of slightly more than 5% of all observations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">bscoup</span><span class="op">$</span><span class="kw">coup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">bscoup</span><span class="op">$</span><span class="kw">coup</span> <span class="op">==</span> <span class="st">"yes"</span>, <span class="fl">1</span>, <span class="fl">0</span>)
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw">bscoup</span><span class="op">$</span><span class="kw">coup</span>)
</pre></div>
<pre><code>## 
##    0    1 
## 5173  290</code></pre>
<p>Before we can estimate a split-population duration model with the data, we need to add several variables that capture the survival characteristics of the data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">bscoup</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_duration.html">add_duration</a></span>(<span class="kw">bscoup</span>, <span class="st">"coup"</span>, unitID = <span class="st">"countryid"</span>, tID = <span class="st">"year"</span>,
                            freq = <span class="st">"year"</span>, ongoing = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in attempt_date(data[, tID], freq): Converting to 'Date' class with
## yyyy-06-30</code></pre>
<p>The <code>add_duration</code> function takes as input a data frame with a binary response variable–“coup”–that measures the occurrence of the event, or failure, recorded over discrete time periods. We assume that the data frame is in a cross-sectional time-series format that consists of multiple observations over time for a number of subjects, in our case countries.</p>
<p>Within the framework of duration modeling, these data conceptually consist of “spells”, which are repeated observations of a unit from the time they enter the data (left-censoring) or after they experienced the event of interest, until the next event or the end of observation (right censoring). The table below shows how a single country could have two spells during the observation period. Observations for Portugal make up two spells, one that begins in 1960, when our data start, to a coup event in 1975, when a second spell starts and continues until either the next coup or the data end. Canada on the other hand experienced no coups and so observations for that country from 1960 to 2000 make up one spell.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Country</th>
<th align="right">Year</th>
<th align="right">Coup</th>
<th align="right">Spell ID</th>
<th align="right">Duration</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Portugal</td>
<td align="right">1960</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">…</td>
<td align="right">…</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">…</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="right">1975</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">Portugal</td>
<td align="right">1976</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="right">…</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">…</td>
</tr>
<tr class="even">
<td align="left">…</td>
<td align="right">2000</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">Canada</td>
<td align="right">1960</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">…</td>
<td align="right">…</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">…</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="right">2000</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">41</td>
</tr>
</tbody>
</table>
<p>The <code>add_duration</code> functions identifies spells in the data and returns the data frame with several additional variables needed for estimation. The most important among these are a counter of elapsed time in a spell, “duration”. It also codes that a spell was at risk (“atrisk==1”) if it ended in a failure event, and not at risk otherwise. These are then used as response variables for the formula in the <code>spdur</code> function.</p>
<p>Though the data used in this example are recorded annually, the function supports annual, monthly, or daily data and will try to convert the <code>tID</code> input to class “Date” given the provided argument in <code>freq</code>, as indicated by the warning it returned in the example above. This can be avoided by converting any numeric dates to R dates first.</p>
<p>Another important question is how to handle consecutive 1’s in the response variable provided. This is controlled with the <code>ongoing</code> argument. In some cases like civil war occurrence, the <em>y</em> variable records all years during which a country experienced a civil war. Here <code>ongoing</code> should be set to true so that the models try to predict the onset of the civil war, but disregard ongoing conflicts (failure is set to <code>NA</code> for these cases, dropping them from analysis). With <code>ongoing</code> set to false, successive 1’s in <em>y</em> are treated as distinct and new failures, and kept in the analysis. This makes sense for discrete, short-term events like coups. Countries can experience distinct coups in successive years.</p>
<p>The <code>spdur</code> function is the primary function in the package and produces a regression model object of class <code>spdur</code> which can then be used with further methods. We begin by fitting first a Weibull and then a log-logistic split-population duration model using the coups data, including the measure of coup risk in the logit (risk) equation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">weib_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spdur.html">spdur</a></span>(
  <span class="kw">duration</span> <span class="op">~</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">instab</span> <span class="op">+</span> <span class="kw">regconf</span>,
  <span class="kw">atrisk</span> <span class="op">~</span> <span class="kw">couprisk</span> <span class="op">+</span> <span class="kw">wealth</span> <span class="op">+</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">rwar</span> <span class="op">+</span> <span class="kw">regconf</span> <span class="op">+</span> <span class="kw">samerica</span> <span class="op">+</span> <span class="kw">camerica</span>,
  data = <span class="kw">bscoup</span>, distr = <span class="st">"weib"</span>, silent = <span class="fl">TRUE</span>)

<span class="kw">loglog_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spdur.html">spdur</a></span>(
  <span class="kw">duration</span> <span class="op">~</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">instab</span> <span class="op">+</span> <span class="kw">regconf</span>,
  <span class="kw">atrisk</span> <span class="op">~</span> <span class="kw">couprisk</span> <span class="op">+</span> <span class="kw">wealth</span> <span class="op">+</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">rwar</span> <span class="op">+</span> <span class="kw">regconf</span> <span class="op">+</span> <span class="kw">samerica</span> <span class="op">+</span> <span class="kw">camerica</span>,
  data = <span class="kw">bscoup</span>, distr = <span class="st">"loglog"</span>, silent = <span class="fl">TRUE</span>)
</pre></div>
<p>Using the <code>summary</code> function on either model object will produce standard output showing the model formula, estimates for the duration and risk equations, and test statistics with <span class="math inline">\(p\)</span>-values. These can be exported by calling <code>xtable</code> directly on the “spdur” object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="http://xtable.r-forge.r-project.org">"xtable"</a></span>)
<span class="kw">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xtable/man/xtable.html">xtable</a></span>(<span class="kw">loglog_model</span>, caption = <span class="st">"Coup model with log-logistic hazard"</span>,
              label = <span class="st">"loglog_table"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">tbl</span>, type = <span class="st">"html"</span>, caption.placement = <span class="st">"top"</span>, comment = <span class="fl">FALSE</span>, include.rownames = <span class="fl">FALSE</span>)
</pre></div>
<table class="table">
<caption align="top">
Coup model with log-logistic hazard
</caption>
<tr>
<th>
Parameter
</th>
<th>
Estimate
</th>
<th>
Std. Error
</th>
<th>
t value
</th>
<th>
Pr(&gt;|t|)
</th>
</tr>
<tr>
<td>
Dur_(Intercept)
</td>
<td align="right">
2.40
</td>
<td align="right">
0.21
</td>
<td align="right">
11.43
</td>
<td align="right">
0.00
</td>
</tr>
<tr>
<td>
Dur_milreg
</td>
<td align="right">
-1.13
</td>
<td align="right">
0.21
</td>
<td align="right">
-5.46
</td>
<td align="right">
0.00
</td>
</tr>
<tr>
<td>
Dur_instab
</td>
<td align="right">
-0.09
</td>
<td align="right">
0.02
</td>
<td align="right">
-4.79
</td>
<td align="right">
0.00
</td>
</tr>
<tr>
<td>
Dur_regconf
</td>
<td align="right">
-2.52
</td>
<td align="right">
2.16
</td>
<td align="right">
-1.16
</td>
<td align="right">
0.24
</td>
</tr>
<tr>
<td>
log(alpha)
</td>
<td align="right">
-0.45
</td>
<td align="right">
0.06
</td>
<td align="right">
-7.09
</td>
<td align="right">
0.00
</td>
</tr>
<tr>
<td>
Risk_(Intercept)
</td>
<td align="right">
2.93
</td>
<td align="right">
1.87
</td>
<td align="right">
1.57
</td>
<td align="right">
0.12
</td>
</tr>
<tr>
<td>
Risk_couprisk
</td>
<td align="right">
0.59
</td>
<td align="right">
0.32
</td>
<td align="right">
1.82
</td>
<td align="right">
0.07
</td>
</tr>
<tr>
<td>
Risk_wealth
</td>
<td align="right">
-0.36
</td>
<td align="right">
0.28
</td>
<td align="right">
-1.29
</td>
<td align="right">
0.20
</td>
</tr>
<tr>
<td>
Risk_milreg
</td>
<td align="right">
10.82
</td>
<td align="right">
9.29
</td>
<td align="right">
1.16
</td>
<td align="right">
0.24
</td>
</tr>
<tr>
<td>
Risk_rwar
</td>
<td align="right">
-0.53
</td>
<td align="right">
0.94
</td>
<td align="right">
-0.56
</td>
<td align="right">
0.58
</td>
</tr>
<tr>
<td>
Risk_regconf
</td>
<td align="right">
-5.43
</td>
<td align="right">
5.62
</td>
<td align="right">
-0.97
</td>
<td align="right">
0.33
</td>
</tr>
<tr>
<td>
Risk_samerica
</td>
<td align="right">
2.10
</td>
<td align="right">
1.45
</td>
<td align="right">
1.44
</td>
<td align="right">
0.15
</td>
</tr>
<tr>
<td>
Risk_camerica
</td>
<td align="right">
-0.39
</td>
<td align="right">
0.73
</td>
<td align="right">
-0.53
</td>
<td align="right">
0.59
</td>
</tr>
</table>
<p>The table shows estimates from the duration equation, beginning with the intercept, and then estimates from the risk equation. The duration component of the model is in accelerated failure time format and the coefficient estimates are on the log of expected time to failure. The negative coefficient for military regimes for example means that the expected time to a coup is shorter in military regimes than non-military regimes, holding all other factors constant. In the risk equation, positive coefficients mean higher risk of coup. Thus, military regimes have a higher risk of experiencing a coup.</p>
<p>One may also use the <code>AIC</code> and <code>BIC</code> function to calculate the information criterion statistics for <code>spdur</code> objects. In our example, both models are close enough in both statistics to be indistinguishable, so we will continue to focus on the log-logistic form.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span>(<span class="kw">weib_model</span>), <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span>(<span class="kw">loglog_model</span>), <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span>(<span class="kw">weib_model</span>), <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span>(<span class="kw">loglog_model</span>)
  ), ncol = <span class="fl">2</span>, dimnames = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Weibull"</span>, <span class="st">"Loglog"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AIC"</span>, <span class="st">"BIC"</span>)))
</pre></div>
<pre><code>##              AIC      BIC
## Weibull 1329.908 1348.972
## Loglog  1331.214 1350.278</code></pre>
<p>The package includes two types of plots that show the estimated hazard rates and predictive performance, respectively. The hazard rates can be plotted by either calling <code>plot_hazard</code> directly, or with <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(x, type = "hazard")</a></code>, on a fitted <code>spdur</code> object. It will produce a plot of the conditional hazard, which is the probability of survival conditional on the covariates in the risk and duration equations, and conditional on survival up to time t, when holding all covariates at their sample means. The function calculates the average hazard rate as well as 90% confidence intervals, which are produced by simulating values from the estimated sampling distributions of the model parameters.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">weib_model</span>,   type=<span class="st">"hazard"</span>, main=<span class="st">"Weibull"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">loglog_model</span>, type=<span class="st">"hazard"</span>, main=<span class="st">"Loglog"</span>)
</pre></div>
<p><img src="introduction_files/figure-html/hazard-ex-1-1.png" width="700"><img src="introduction_files/figure-html/hazard-ex-1-2.png" width="700"></p>
<p>By default the <code>plot_hazard</code> function uses the mean values of the covariates during the simulations, but users can choose specific covariate values by entering them as vectors in the arguments <code>xvals</code> and <code>zvals</code>, which correspond to the covariates in the duration and risk equations, respectively. The values are used in the same order that variables are specified in the equations used to estimate the models, which also corresponds to the order of variables in the model summary table. Note the inclusion of an intercept term.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="../reference/plot_hazard.html">plot_hazard</a></span>(<span class="kw">loglog_model</span>,
     xvals = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">0.05</span>),
     zvals = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">8.64</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0</span>, <span class="fl">0</span>),
     main = <span class="st">"High risk scenario"</span>)
</pre></div>
<p><img src="introduction_files/figure-html/hazard-ex-2-1.png" width="700"></p>
<p>While <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(x, type = "hazard")</a></code> will produce a hazard plot, without a type argument, <code>plot.spdur</code> will produce a separation plot, which is a graphical display for evaluating model predictions <span class="citation">(Greenhill, Ward, and Sacks 2011)</span>. The code below produces the figure below:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(mfrow=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">1</span>), mar=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">weib_model</span>, heading = <span class="st">"Weibull"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">loglog_model</span>, heading = <span class="st">"LogLog"</span>)
</pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>The option <code>endSpellOnly</code> is set to <code>FALSE</code> so that every observation, not only those at the end of a spell, is used in the plot. By default the <code>plot</code> function will calculate the conditional hazard for each observation. The separation plot sorts observations from left to right according to the predicted probability assigned by the model (higher values to the right), and shows each event/failure as red line, with non-events shown in beige. This makes it easy to see whether the model is assigning high probabilities of failure to actual cases of failure, and low probabilities to non-failures.</p>
<p>Underlying both plotting functions is the <code>predict</code> function, which can be used on an object of class <code>spdur</code> to generate several kinds of predictions, including the probability that an observation is ``at-risk’’ and the probability of failure for a given time period.</p>
<div id="out-of-sample-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#out-of-sample-testing" class="anchor"></a>Out-of-sample testing</h2>
<p>Finally, we demonstrate how to evaluate a model’s out of sample predictions. We will use data from 1996 onwards as the test set, and prior data for training purposes. The <code>add_duration</code> function retrospectively codes the risk variable based on how a spell ended, and we therefore need to take care in how we add the duration variables for each data set. For the training data we need to subset the training set first, so that coups in the tests set don’t influence the risk coding in the training data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">bscoup</span>)
<span class="kw">bscoup</span><span class="op">$</span><span class="kw">coup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">bscoup</span><span class="op">$</span><span class="kw">coup</span> <span class="op">==</span> <span class="st">"yes"</span>, <span class="fl">1</span>, <span class="fl">0</span>)
<span class="kw">coup_train</span> <span class="op">&lt;-</span> <span class="kw">bscoup</span>[<span class="kw">bscoup</span><span class="op">$</span><span class="kw">year</span> <span class="op">&lt;</span> <span class="fl">1996</span>, ]
<span class="kw">coup_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_duration.html">add_duration</a></span>(<span class="kw">coup_train</span>, <span class="st">"coup"</span>, unitID = <span class="st">"countryid"</span>, tID = <span class="st">"year"</span>,
                          freq = <span class="st">"year"</span>, ongoing = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in attempt_date(data[, tID], freq): Converting to 'Date' class with
## yyyy-06-30</code></pre>
<p>For the test set it is recommended to add the duration variables and <em>then</em> subset the test set. Since the test set is later in time than the training set we do not have to worry about contamination of the risk coding, but if we subset the data before building the duration variables we will start all duration counters at 1996, when in fact we can safely use the previous historic coup information. To do this we need to build the duration variables first:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">coup_test</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_duration.html">add_duration</a></span>(<span class="kw">bscoup</span>, <span class="st">"coup"</span>, unitID = <span class="st">"countryid"</span>, tID = <span class="st">"year"</span>,
                           freq = <span class="st">"year"</span>, ongoing = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in attempt_date(data[, tID], freq): Converting to 'Date' class with
## yyyy-06-30</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="kw">coup_test</span>  <span class="op">&lt;-</span> <span class="kw">coup_test</span>[<span class="kw">coup_test</span><span class="op">$</span><span class="kw">year</span> <span class="op">&gt;=</span> <span class="fl">1996</span>, ]
</pre></div>
<p>Now we can fit new models using the training data, and calculate predictions from these models for the test data, using <code><a href="https://rdrr.io/r/stats/predict.html">predict(..., newdata = coup_test)</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">weib_model2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spdur.html">spdur</a></span>(
  <span class="kw">duration</span> <span class="op">~</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">instab</span> <span class="op">+</span> <span class="kw">regconf</span>,
  <span class="kw">atrisk</span> <span class="op">~</span> <span class="kw">couprisk</span> <span class="op">+</span> <span class="kw">wealth</span> <span class="op">+</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">rwar</span> <span class="op">+</span> <span class="kw">regconf</span> <span class="op">+</span> <span class="kw">samerica</span> <span class="op">+</span> <span class="kw">camerica</span>,
  data = <span class="kw">coup_train</span>, silent = <span class="fl">TRUE</span>)

<span class="kw">loglog_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spdur.html">spdur</a></span>(
  <span class="kw">duration</span> <span class="op">~</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">instab</span> <span class="op">+</span> <span class="kw">regconf</span>,
  <span class="kw">atrisk</span> <span class="op">~</span> <span class="kw">couprisk</span> <span class="op">+</span> <span class="kw">wealth</span> <span class="op">+</span> <span class="kw">milreg</span> <span class="op">+</span> <span class="kw">rwar</span> <span class="op">+</span> <span class="kw">regconf</span> <span class="op">+</span> <span class="kw">samerica</span> <span class="op">+</span> <span class="kw">camerica</span>,
  data = <span class="kw">coup_train</span>, distr = <span class="st">"loglog"</span>, silent = <span class="fl">TRUE</span>)
</pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="kw">weib2_test_p</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">weib_model2</span>, newdata = <span class="kw">coup_test</span>, na.action = <span class="kw">na.omit</span>)
<span class="kw">loglog2_test_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">loglog_model2</span>, newdata = <span class="kw">coup_test</span>, na.action = <span class="kw">na.omit</span>)
</pre></div>
<p>Since we are predicting for data that is not contained in the “spdur” model objects, we have to use the <code>separationplot</code> functions directly from the package to produce the figure below:</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"separationplot"</span>)
</pre></div>
<pre><code>## Loading required package: RColorBrewer</code></pre>
<pre><code>## Loading required package: Hmisc</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## Loading required package: Formula</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## 
## Attaching package: 'Hmisc'</code></pre>
<pre><code>## The following objects are masked from 'package:xtable':
## 
##     label, label&lt;-</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     format.pval, units</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## Loading required package: foreign</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="kw">obs_y</span> <span class="op">&lt;-</span> <span class="kw">coup_test</span>[<span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span>(<span class="kw">coup_test</span>), <span class="st">"coup"</span>]

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(mfrow=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">1</span>),mar=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/pkg/separationplot/man/separationplot.html">separationplot</a></span>(<span class="kw">weib2_test_p</span>,   <span class="kw">obs_y</span>, newplot = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/separationplot/man/separationplot.html">separationplot</a></span>(<span class="kw">loglog2_test_p</span>, <span class="kw">obs_y</span>, newplot = <span class="fl">FALSE</span>)
</pre></div>
<p><img src="introduction_files/figure-html/oos-sepplots-1.png" width="480"></p>
</div>
</div>
<div id="additional-discussion" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-discussion" class="anchor"></a>Additional discussion</h1>
<div id="censoring-considerations" class="section level2">
<h2 class="hasAnchor">
<a href="#censoring-considerations" class="anchor"></a>Censoring considerations</h2>
<p>Truncation and censoring are problematic for split-population duration models, as they are for standard duration regression, but also pose some additional considerations. In left-truncation, we do not observe data for a spell prior to some date, and thus have incomplete and inaccurate values for the duration or time to failure for a spell. Since immune spells in the sample are over time going to distinguish themselves with exceptionally long survival times compared to spells at risk which fail periodically, left-censoring also makes it more difficult to distinguish the immune and at risk subpopulations.</p>
<p>Sometimes information about previous failures in the data is available beyond the time period over which covariates are observed, making it possible to ameliorate or eliminate left-censoring by using the information of previous failures when constructing the necessary duration variables with <code><a href="../reference/add_duration.html">add_duration()</a></code>.</p>
<p>Right-censoring, where spells end before outcomes are observed, also pose a unique problem in the split-population framework. Although right-censored spells themselves are accommodated in the modeling function, they impact the coding of at risk vs. immune spells. The <code><a href="../reference/add_duration.html">add_duration()</a></code> function retroactively codes all observations in a spell as at risk if the spell itself ended in failure. Right-censored spells are coded as immune over their entire duration. This can lead to some misclassification of observations as immune even though they experience failure at some point in the unobserved future.</p>
<p>Furthermore, as the example above shows, in out-of-sample testing based on some kind of data partitioning scheme, this coding scheme can lead to unintentional contamination of in-sample cases with knowledge of out-of-sample failures through the risk coding for failed spells. This leads to two recommendations. First, data should be partitioned spell or block-wise, e.g., by withholding the last <em>x</em> years of data, and not randomly. Second, given the two concerns of left-censoring and non-independence induced through the duration and risk coding, care should be taken to ensure that duration data are built without access to future information in another data partition.</p>
</div>
<div id="alternative-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#alternative-packages" class="anchor"></a>Alternative packages</h2>
<p>The <code>survival</code> package <span class="citation">(Thernau 2000, @thernau2015survival)</span>, arguably the most well-established library for survival and event history analysis in R, allows for the estimation of a wide variety of semi-, non-, and parametric survival models, and provides facilities for handling and descriptive summaries of survival and event history data. It does not include cure rate or split-population mixture models of the type we have implemented though.</p>
<p>One useful extension of our project in the future would be to integrate and adapt the <code>Surv</code> class for survival data in <code>survival</code> to the <code>spduration</code> library. This would require some modification of the class as our model also requires information on the risk status of spells, but would give access to the much broader functionality, especially for descriptive summaries of data, in the <code>survival</code> library.</p>
<p>Other currently available R routines for estimation of split-population/cure rate duration models include the packages <code>smcure</code> <span class="citation">(Cai et al. 2012b)</span>, described in <span class="citation">Cai et al. (2012a)</span>, and <code>nltm</code> <span class="citation">(Garibotti and Tsodikov 2010)</span>. <code>smcure</code> implements semi-parametric proportional hazards and accelerated failure time cure models using estimation procedures presented in <span class="citation">Peng (2003)</span> and <span class="citation">Zhang and Peng (2007)</span>.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> The package <code>nltm</code> will estimate a semi-parametric proportional hazard cure model, and a number of other survival models, using the approach developed in <span class="citation">Tsodikov (2003)</span> and <span class="citation">Tsodikov and Garibotti (2007)</span>. Semi-parametric estimation of the hazard function is attractive because it requires no assumption about its shape, and such assumptions can be difficult in practice to empirically evaluate. The main advantage <code>spduration</code> offers is the ability to include time varying covariates, which gives it a broader range of practical applications, as <code>smcure</code> and<code>nltm</code> will only accommodate case-based data. <code>spduration</code> also features more post-estimation methods than alternative packages, including those discussed above to create and evaluate model predictions.</p>
<p>Finally, there are Stata routines for implementing cure models <span class="citation">(see, e.g., Lambert 2007; Buxton 2013)</span>, some of which can handle time-varying covariates, but this is of course of limited appeal to R users.</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>Many outcomes of interest are rare events. For example, coups, war onset, or mass killings are exceedingly rare events when considering that most countries do not experience high levels of violence. The figure below shows a few examples of published research that models binary outcomes. <span class="citation">Fearon and Laitin (2003)</span> is a widely cited study of civil war onset that uses yearly observations of all major countries; <span class="citation">Beger, Dorff, and Ward (2014)</span> is an example of the positive rates when moving to monthly data for a similar set of countries. The positive rates range from 5 to less than 0.2% of all data points.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<p><img src="rates.png"></p>
<p>In the language of machine learning, we are dealing with highly imbalanced classes. It is a well-recognized problem and has led to the development or use of several specialized mixture models like zero-inflated Poisson and negative binomial regression for count data, and a zero-inflated ordered probit for ordinal outcomes <span class="citation">(Bagozzi et al. 2015)</span>. Split-population duration regression provides another principled solution to the challenges posed by data in this domain, but, unlike other solutions to the sparse outcome problem, also addresses underlying temporal dynamics that are an important part of the non-independent data political scientists and other social scientists commonly use.</p>
<p>Split-population duration models are not only appealing in a technical sense, but they also match the logic or intuition many social scientists use when they distinguish long-term risk factors from more fleeting triggering causes. The example we have used, <span class="citation">Belkin and Schofer (2003)</span>, is a particularly clear illustration of how well the language of theorists maps onto the model intuition.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-bagozzi2015modeling">
<p>Bagozzi, Benjamin E., Daniel W. Hill, Will H. Moore, and Bumba Mukherjee. 2015. “Modeling Two Types of Peace the Zero-Inflated Ordered Probit (Ziop) Model in Conflict Research.” <em>Journal of Conflict Resolution</em> 59 (4): 728–52.</p>
</div>
<div id="ref-beger2014ensemble">
<p>Beger, Andreas, Cassy L. Dorff, and Michael D. Ward. 2014. “Ensemble Forecasting of Irregular Leadership Change.” <em>Research &amp; Politics</em> 1 (3): 1–7.</p>
</div>
<div id="ref-belkin2003toward">
<p>Belkin, Aaron, and Evan Schofer. 2003. “Toward a Structural Understanding of Coup Risk.” <em>Journal of Conflict Resolution</em> 47 (5): 594–620.</p>
</div>
<div id="ref-berkson1952survival">
<p>Berkson, Joseph, and Robert P. Gage. 1952. “Survival Curve for Cancer Patients Following Treatment.” <em>Journal of the American Statistical Association</em> 47 (259): 501–15.</p>
</div>
<div id="ref-boag1949maximum">
<p>Boag, John W. 1949. “Maximum Likelihood Estimates of the Proportion of Patients Cured by Cancer Therapy.” <em>Journal of the Royal Statistical Society B</em> 11 (1): 15–53.</p>
</div>
<div id="ref-buxton2013cureregr">
<p>Buxton, Allen. 2013. “CUREREGR: Stata Module to Estimate Parametric Cure Regression.” <a href="http://EconPapers.repec.org/RePEc:boc:bocode:s446901">http://EconPapers.repec.org/RePEc:boc:bocode:s446901</a>.</p>
</div>
<div id="ref-cai2012smcure">
<p>Cai, Chao, Yubo Zou, Yingwei Peng, and Jiajia Zhang. 2012a. “Smcure: An R-Package for Estimating Semiparametric Mixture Cure Models.” <em>Computer Methods and Programs in Biomedicine</em> 108 (3): 1255–60.</p>
</div>
<div id="ref-cai2012smcureR">
<p>———. 2012b. <em>Smcure: Fit Semiparametric Mixture Cure Models</em>. <a href="https://CRAN.R-project.org/package=smcure">https://CRAN.R-project.org/package=smcure</a>.</p>
</div>
<div id="ref-deyoung2003failure">
<p>DeYoung, Robert. 2003. “The Failure of New Entrants in Commercial Banking Markets: A Split-Population Duration Analysis.” <em>Review of Financial Economics</em> 12 (1): 7–33.</p>
</div>
<div id="ref-douglas1994hazard">
<p>Douglas, Stratford, and Govind Hariharan. 1994. “The Hazard of Starting Smoking: Estimates from a Split Population Duration Model.” <em>Journal of Health Economics</em> 13 (2): 213–30.</p>
</div>
<div id="ref-fearon2003ethnicity">
<p>Fearon, James D., and David D. Laitin. 2003. “Ethnicity, Insurgency, and Civil War.” <em>American Political Science Review</em> 97 (1): 75–90.</p>
</div>
<div id="ref-forster2001role">
<p>Forster, Martin, and Andrew M. Jones. 2001. “The Role of Tobacco Taxes in Starting and Quitting Smoking: Duration Analysis of British Data.” <em>Journal of the Royal Statistical Society A</em> 164 (3): 517–47.</p>
</div>
<div id="ref-garibotti2010nltm">
<p>Garibotti, Gilda, and Alexander Tsodikov. 2010. <em>Nltm: Nonlinear Transformation Models</em>. <a href="https://cran.r-project.org/src/contrib/Archive/nltm/">https://cran.r-project.org/src/contrib/Archive/nltm/</a>.</p>
</div>
<div id="ref-greenhill2011separation">
<p>Greenhill, Brian, Michael D. Ward, and Audrey Sacks. 2011. “The Separation Plot: A New Visual Method for Evaluating the Fit of Binary Models.” <em>American Journal of Political Science</em> 55 (4): 991–1002.</p>
</div>
<div id="ref-king2001explaining">
<p>King, Gary, and Langche Zeng. 2001a. “Explaining Rare Events in International Relations.” <em>International Organization</em> 55 (03): 693–715.</p>
</div>
<div id="ref-king2001logistic">
<p>———. 2001b. “Logistic Regression in Rare Events Data.” <em>Political Analysis</em> 9 (2): 137–63.</p>
</div>
<div id="ref-lambert2007modeling">
<p>Lambert, Paul C. 2007. “Modeling of the Cure Fraction in Survival Studies.” <em>Stata Journal</em> 7 (3): 351.</p>
</div>
<div id="ref-peng2003fitting">
<p>Peng, Yingwei. 2003. “Fitting Semiparametric Cure Models.” <em>Computational Statistics &amp; Data Analysis</em> 41 (3): 481–90.</p>
</div>
<div id="ref-peng1998generalized">
<p>Peng, Yingwei, Keith BG Dear, and JW Denham. 1998. “A Generalized F Mixture Model for Cure Rate Estimation.” <em>Statistics in Medicine</em> 17 (8): 813–30.</p>
</div>
<div id="ref-schmidt1989predicting">
<p>Schmidt, Peter, and Ann Dryden Witte. 1989. “Predicting Criminal Recidivism Using Split Population Survival Time Models.” <em>Journal of Econometrics</em> 40 (1): 141–59.</p>
</div>
<div id="ref-svolik2008authoritarian">
<p>Svolik, Milan. 2008. “Authoritarian Reversals and Democratic Consolidation.” <em>American Political Science Review</em> 102 (2): 153–68.</p>
</div>
<div id="ref-thernau2000modeling">
<p>Thernau, Terry M. 2000. <em>Modeling Survival Data: Extending the Cox Model</em>. New York: Springer.</p>
</div>
<div id="ref-thernau2015survival">
<p>———. 2015. <em>A Package for Survival Analysis in S</em>. <a href="https://CRAN.R-project.org/package=survival">https://CRAN.R-project.org/package=survival</a>.</p>
</div>
<div id="ref-tsodikov2003semiparametric">
<p>Tsodikov, Alex. 2003. “Semiparametric Models: A Generalized Self-Consistency Approach.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 65 (3): 759–74.</p>
</div>
<div id="ref-tsodikov2007profile">
<p>Tsodikov, Alexander, and Gilda Garibotti. 2007. “Profile Information Matrix for Nonlinear Transformation Models.” <em>Lifetime Data Analysis</em> 13 (1): 139–59.</p>
</div>
<div id="ref-ward2013learning">
<p>Ward, Michael D., Nils W. Metternich, Cassy L. Dorff, Max Gallop, Florian M. Hollenbach, Anna Schultz, and Simon Weschle. 2013. “Learning from the Past and Stepping into the Future: Toward a New Generation of Conflict Prediction.” <em>International Studies Review</em> 15 (4): 473–90.</p>
</div>
<div id="ref-zhang2007new">
<p>Zhang, Jiajia, and Yingwei Peng. 2007. “A New Estimation Method for the Semiparametric Accelerated Failure Time Mixture Cure Model.” <em>Statistics in Medicine</em> 26 (16): 3157–71.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Usual presentation of the split-population duration framework in medical contexts focus on the “cured” subpopulation. In our applications events are typically rare and it thus is easier to emphasize the “risk”" subpopulation. As risk = 1 - cured, this difference is trivial.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>We use ``spell’’ to designate all time periods observed for a subject up to the failure time. Subjects can theoretically have multiple spells, e.g., cancer patients who go into remission and relapse more than once, or states that experience multiple civil wars over their history.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>There is also the older <code>gfcure</code> package, which estimates the parametric accelerated failure time cure model discussed in <span class="citation">Peng, Dear, and Denham (1998)</span>. A version for Windows is available at <a href="http://post.queensu.ca/~pengp/software.html" class="uri">http://post.queensu.ca/~pengp/software.html</a>.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>For a discussion of the difficulties rare events can pose for prediction see <span class="citation">King and Zeng (2001b)</span> and <span class="citation">King and Zeng (2001a)</span>.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andreas Beger, Daina Chiba, Daniel W. Hill, Jr., Nils W. Metternich, Shahryar Minhas, Michael D. Ward.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
